{% extends "DHT/base.html" %}
{% block title %}Incidents{% endblock %}

{% block content %}

<div class="container mt-4">

    <h2 class="mb-4 text-center">ğŸ“¡ Centre de Surveillance â€“ Cold Chain</h2>

    <div class="row">

        <!-- INCIDENT -->
        <div class="col-md-6">
            <div class="card shadow p-3 mb-4">
                <h4 class="mb-3">ğŸš¨ Incident rÃ©cent</h4>

                {% if last_incident %}
                    <p><strong>Type :</strong> {{ last_incident.get_incident_type_display }}</p>
                    <p><strong>Temp :</strong> {{ last_incident.temp }} Â°C</p>
                    <p><strong>Hum :</strong> {{ last_incident.hum }} %</p>
                    <p><strong>Date :</strong> {{ last_incident.created_at|date:"d/m/Y H:i" }}</p>
                    <!-- <a href="/incidents/{{ last_incident.id }}/" class="btn btn-danger">Voir</a> -->
                {% else %}
                    <p class="text-success">âœ” Aucun incident dÃ©tectÃ©</p>
                {% endif %}
            </div>
        </div>

        <!-- TEMP NORMALE -->
        <div class="col-md-6">
            <div class="card shadow p-3 mb-4">
                <h4 class="mb-3">ğŸŒ¡ TempÃ©rature normale</h4>

{% if temp_min is not None %}
    <p>Normal : <strong>{{ temp_min }}Â°C â‰¤ Temp â‰¤ {{ temp_max }}Â°C</strong></p>
{% else %}
    <p class="text-warning">âš  Seuils non dÃ©finis</p>
{% endif %}

                {% if last %}
                    <p><strong>TempÃ©rature actuelle :</strong> {{ last.temp }}Â°C</p>
                    <p><strong>HumiditÃ© actuelle :</strong> {{ last.hum }}%</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- COMPTEUR -->
    <div class="card shadow p-3 mb-4">
        <h4 class="mb-3">ğŸ“Š Compteurs dâ€™alertes</h4>
        <p><strong>Total incidents :</strong> {{ total_incidents }}</p>

        <!-- âœ” button li bghiti -->
<a href="{% url 'incidents_list' %}" class="btn btn-primary btn-lg shadow-sm">
    ğŸš¨ Voir la liste des incidents
</a>


    </div>

    <!-- COMMENTAIRES -->
    <div class="card shadow p-3 mb-4">
        <form method="POST">
    {% csrf_token %}
    <h3 class="commentaire">Commentaires </h3>
</form>

{% for c in comments %}
<div class="alert alert-info mt-2">
    <strong>{{ c.user.username }}</strong> :
    {{ c.content }} <br>
    <small>{{ c.created_at|date:"d/m/Y H:i" }}</small>
</div>
{% empty %}
<p class="text-muted mt-3">Aucun commentaire.</p>
{% endfor %}

    </div>

</div>

{% endblock %}
